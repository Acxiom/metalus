language: scala

scala:
- 2.11.12

jobs:
  include:
  - stage: build
    os: linux
    script: mvn clean install
  -
    os: osx
    osx_image: xcode9.3
    script: mvn clean install
  - stage: coverage
    if: branch = master
    os: linux
    before_script:
      - mvn versions:set -DremoveSnapshot
    script: mvn -DrepoToken=$coverallsToken clean scoverage:report install scala:doc scalastyle:check coveralls:report
    before_deploy:
      - export project_version=$(mvn help:evaluate -N -Dexpression=project.version|grep -v '\[')
    deploy:
      provider: releases
      api_key: $GITHUB_OAUTH_TOKEN
      name: $project_version
      skip_cleanup: true
      file_glob: true
      file:
        - common-pipeline-steps/target/common-pipeline-steps_2.11-*.jar
        - spark-pipeline-engine/target/spark-pipeline-engine_2.11-*.jar
        - streaming-pipeline-drivers/target/streaming-pipeline-drivers_2.11-*.jar
